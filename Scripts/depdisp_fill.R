#MK fill in missing TAG_DEPARTED due to replacement.

depdisp_fill<-function(loc,tempdf){             #where loc is the current location in the datastream a where departure label is missing and df is a dataframe for a given antenna containing all of the ARRIVAL and DEPARTURE events
  loc<-as.numeric(loc)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  label<-if(toString(tempdf[loc,2]) %in% c("TAG_ARRIVED_A")){"ATAG_DEPARTED_A"} else {"ATAG_DEPARTED_B"}    #Get departure label that corresponds to current antenna
  depdf<-data.frame(TS=tempdf[(loc+1),1],LABEL=label,ID=tempdf[loc,3],pos=1,secs=tempdf[(loc+1),"secs"])                                                    #Create a Timestamp for the departure label that has a time equal to the next ARRIVAL event, as the DEPARTURES that have been missed are due to displacements (i.e. dominance events where one individual immediately replaces another on an antenna)
  dispdf<-data.frame(TS=tempdf[(loc+1),1],LABEL="REPLACEMENT",ID=paste(toString(tempdf[(loc+1),3]),toString(tempdf[loc,3]),sep="_"),pos=1,secs=tempdf[(loc+1),"secs"])       #Create an additional "REPLACEMENT" label for the event
  outdf<-rbind(dispdf,depdf)     #Output both the DEPARTURE and the REPLACEMENT label for the current ARRIVAL
  return(outdf)
}
